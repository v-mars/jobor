import{d as k,T as z,m as y,i as M,B as w,C as T,G as b,V,S as r,E as n,J as a,a4 as D,D as R,a2 as W,W as B,X as L,Y as j,F as E,a8 as I,Z as g,U as O,a9 as A,aa as K,h as u}from"./index-1e5c8491.js";import{u as F}from"./useRequest-4b136d38.js";import{_ as G}from"./RoleSelect.vue_vue_type_script_setup_true_lang-177eceda.js";import{N as H}from"./Switch-bff57621.js";import{N as J,a as p}from"./FormItem-0a8cafc8.js";import{b as h,N as X}from"./Icon-21fd7f90.js";import{u as Y,_ as Z}from"./useTableData-439b193e.js";import{_ as Q,a as ee}from"./EditButton.vue_vue_type_script_setup_true_lang-68e745ad.js";import{_ as ae}from"./TooltipText.vue_vue_type_script_setup_true_lang-ee7cde28.js";import{_ as te,a as le}from"./AutoOmissionTag.vue_vue_type_script_setup_true_lang-10de12ba.js";import{_ as se}from"./RestPassword.vue_vue_type_script_setup_true_lang-e68584d6.js";import{b as re}from"./Dropdown-21896152.js";import"./get-3c87b9d3.js";import"./Forward-2300206c.js";import"./FocusDetector-5352f935.js";import"./Space-a8bace72.js";import"./validate-1d95410a.js";const ne={flex:"","justify-end":""},S=k({__name:"UserModal",props:{record:null},emits:["refresh"],setup(v,{emit:f}){const c=v,{record:l}=z(c),i=y(!1),_=y(null),{run:x,loading:U}=F(g.createUser),{run:N,loading:$}=F(g.editUser),e=y({username:"",nickname:"",email:"",phone:"",role_ids:[],user_type:"local",status:!0,password:null}),o={name:{required:!0,message:"请输入部门名",trigger:"blur"},password:{required:!0,message:"请输入密码",trigger:"blur"}};function d(){var m,t;if(i.value=!0,l!=null&&l.value){const s=(t=(m=l.value)==null?void 0:m.roles)==null?void 0:t.map(q=>q.id);e.value={...l.value,role_ids:s}}}const C=M(()=>!!(l!=null&&l.value));function P(){var m;(m=_.value)==null||m.validate(async t=>{if(t)return;const{result:s}=l!=null&&l.value?await N(l==null?void 0:l.value.id,e.value):await x(e.value);s&&(i.value=!1,f("refresh"))})}return(m,t)=>(w(),T(E,null,[b("span",{onClick:d},[V(m.$slots,"default")]),r(a(j),{show:i.value,"onUpdate:show":t[9]||(t[9]=s=>i.value=s),title:"部门",preset:"card","auto-focus":!1,"w-200":""},{default:n(()=>[r(a(J),{ref_key:"formRef",ref:_,model:e.value,rules:o},{default:n(()=>[r(a(p),{path:"nickname",label:"显示名"},{default:n(()=>[r(a(h),{value:e.value.nickname,"onUpdate:value":t[0]||(t[0]=s=>e.value.nickname=s),placeholder:"输入显示名",onKeydown:t[1]||(t[1]=D(I(()=>{},["prevent"]),["enter"]))},null,8,["value"])]),_:1}),r(a(p),{path:"username",label:"用户名"},{default:n(()=>[r(a(h),{value:e.value.username,"onUpdate:value":t[2]||(t[2]=s=>e.value.username=s),disabled:a(C),placeholder:"请输入用户名"},null,8,["value","disabled"])]),_:1}),a(C)?W("",!0):(w(),R(a(p),{key:0,path:"password",label:"密码",required:""},{default:n(()=>[r(a(h),{value:e.value.password,"onUpdate:value":t[3]||(t[3]=s=>e.value.password=s),placeholder:"请输入用户名"},null,8,["value"])]),_:1})),r(a(p),{path:"email",label:"邮箱"},{default:n(()=>[r(a(h),{value:e.value.email,"onUpdate:value":t[4]||(t[4]=s=>e.value.email=s),placeholder:"请输入邮箱"},null,8,["value"])]),_:1}),r(a(p),{path:"phone",label:"电话"},{default:n(()=>[r(a(h),{value:e.value.phone,"onUpdate:value":t[5]||(t[5]=s=>e.value.phone=s),placeholder:"请输入电话"},null,8,["value"])]),_:1}),r(a(p),{path:"role_ids",label:"用户角色"},{default:n(()=>[r(G,{value:e.value.role_ids,"onUpdate:value":t[6]||(t[6]=s=>e.value.role_ids=s),multiple:"",placeholder:"输入用户角色"},null,8,["value"])]),_:1}),r(a(p),{path:"status",label:"状态"},{default:n(()=>[r(a(H),{value:e.value.status,"onUpdate:value":t[7]||(t[7]=s=>e.value.status=s),placeholder:"请输入"},null,8,["value"])]),_:1}),b("div",ne,[r(a(B),{type:"primary",loading:a(U)||a($),onClick:t[8]||(t[8]=s=>P())},{default:n(()=>[L(" 确定 ")]),_:1},8,["loading"])])]),_:1},8,["model"])]),_:1},8,["show"])],64))}}),oe={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 32 32"},ie=b("path",{d:"M21 2a8.998 8.998 0 0 0-8.612 11.612L2 24v6h6l10.388-10.388A9 9 0 1 0 21 2zm0 16a7.013 7.013 0 0 1-2.032-.302l-1.147-.348l-.847.847l-3.181 3.181L12.414 20L11 21.414l1.379 1.379l-1.586 1.586L9.414 23L8 24.414l1.379 1.379L7.172 28H4v-3.172l9.802-9.802l.848-.847l-.348-1.147A7 7 0 1 1 21 18z",fill:"currentColor"},null,-1),ue=b("circle",{cx:"22",cy:"10",r:"2",fill:"currentColor"},null,-1),de=[ie,ue],me=k({name:"Password",render:function(f,c){return w(),T("svg",oe,de)}}),pe=k({__name:"ResetPasswordButton",props:{btnText:{default:"重置密码"}},setup(v){const f=v,{btnText:c}=z(f),l=y(!1);return(i,_)=>(w(),R(a(B),A({size:"small",loading:l.value,type:"warning",quaternary:""},i.$attrs),{icon:n(()=>[r(a(X),{component:a(me)},null,8,["component"])]),default:n(()=>[L(" "+O(a(c)),1)]),_:1},16,["loading"]))}}),Ce=k({__name:"UserPage",setup(v){const{dataSource:f,loading:c,refresh:l,tableFilter:i,total:_,pagination:x}=Y(g.getUserList);async function U(e){const{result:o}=await g.delUser(e);o&&l()}async function N(e,o){const{result:d}=await g.editUser(e,{status:o});d&&l()}const $=[{title:"序号",key:"id",width:"65"},{title:"用户",key:"nickname",width:"135",resizable:!0,render(e){return u(ae,{label:""},{default:()=>e.nickname})}},{title:"用户名",key:"username",minWidth:"135",resizable:!0},{title:"邮箱",key:"email",resizable:!0},{title:"类型",key:"user_type",align:"center",width:"80",render(e){return u(re,{bordered:!1,type:"primary"},{default:()=>e.user_type})}},{title:"角色",key:"roles",minWidth:"190",resizable:!0,ellipsis:{tooltip:{maxWidth:500}},render(e){var o;return u(te,{names:(o=e.roles)==null?void 0:o.map(d=>d.name)},{})}},{title:"状态",key:"status",width:90,fixed:"right",render(e){return u(le,{status:e.status,checkFunction:()=>N(e.id,!e.status)})}},{title:"操作",key:"action",width:"270",fixed:"right",render(e){return[u(S,{record:e,onRefresh:l},{default:()=>u(Q)}),e.user_type==="local"&&u(se,{id:e.id,onRefresh:l,showOldPassword:!1},{default:()=>u(pe)}),u(ee,{confirmText:"是否删除该用户",delFunction:()=>U(e.id)})]}}];return(e,o)=>(w(),R(Z,{"table-filter":a(i),"onUpdate:tableFilter":o[0]||(o[0]=d=>K(i)?i.value=d:null),data:a(f),loading:a(c),columns:$,total:a(_),pagination:a(x),"search-key":"name","search-place-holder":"请输入用户名",onRefresh:a(l)},{header:n(()=>[r(S,{onRefresh:a(l)},{default:n(()=>[r(a(B),{type:"primary"},{default:n(()=>[L(" 新增用户 ")]),_:1})]),_:1},8,["onRefresh"])]),_:1},8,["table-filter","data","loading","total","pagination","onRefresh"]))}});export{Ce as default};
