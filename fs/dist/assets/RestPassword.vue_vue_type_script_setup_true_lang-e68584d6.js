import{u as f}from"./useRequest-4b136d38.js";import{d as q,T as V,m as n,B as v,C as x,G as m,V as F,S as o,E as l,J as r,D as I,a2 as S,W as U,X as O,Y as L,F as M,Z as P}from"./index-1e5c8491.js";import{v as T}from"./validate-1d95410a.js";import{N as $,a as w}from"./FormItem-0a8cafc8.js";import{b as i}from"./Icon-21fd7f90.js";const j={flex:"","justify-end":""},Y=q({__name:"RestPassword",props:{id:null,showOldPassword:{type:Boolean,default:!0}},emits:["refresh"],setup(c,{emit:g}){const N=c,{id:d,showOldPassword:y}=V(N),u=n(!1),p=n(null),{run:b,loading:k}=f(P.passRestById),{run:h,loading:_}=f(P.resetOneselfPassword),a=n({oldPassword:"",newPassword:"",validateNewPassword:""}),B={oldPassword:{required:!0,message:"请输入旧密码",trigger:"blur"},newPassword:{required:!0,validator(t,e){if(e){if(e===a.value.oldPassword)return new Error("不能与旧密码一样")}else return new Error("请输入新密码");return!0},trigger:"blur"},validateNewPassword:{required:!0,validator(t,e){if(e){if(e!==a.value.newPassword)return new Error("与新密码不一致")}else return new Error("请输入新密码");return!0},trigger:"blur"},email:{required:!1,validator(t,e){if(e){if(!T(e))return new Error("请输入正确的邮箱地址")}else return!0;return!0},trigger:"blur"}},E=()=>{u.value=!0},R=async()=>{var t;(t=p.value)==null||t.validate(async e=>{if(e)return;const s={old_password:a.value.oldPassword,password:a.value.newPassword},{result:C}=d!=null&&d.value?await b({...s,id:d.value}):await h(s);C&&(u.value=!1,g("refresh"))})};return(t,e)=>(v(),x(M,null,[m("span",{onClick:E},[F(t.$slots,"default")]),o(r(L),{show:u.value,"onUpdate:show":e[4]||(e[4]=s=>u.value=s),title:"重置密码",preset:"card","auto-focus":!1,"w-100":""},{default:l(()=>[o(r($),{ref_key:"formRef",ref:p,model:a.value,rules:B},{default:l(()=>[r(y)?(v(),I(r(w),{key:0,path:"oldPassword",label:"旧密码"},{default:l(()=>[o(r(i),{value:a.value.oldPassword,"onUpdate:value":e[0]||(e[0]=s=>a.value.oldPassword=s),type:"password","show-password-on":"click",placeholder:"输入旧密码"},null,8,["value"])]),_:1})):S("",!0),o(r(w),{path:"newPassword",label:"新密码"},{default:l(()=>[o(r(i),{value:a.value.newPassword,"onUpdate:value":e[1]||(e[1]=s=>a.value.newPassword=s),placeholder:"输入新密码",type:"password","show-password-on":"click"},null,8,["value"])]),_:1}),o(r(w),{path:"validateNewPassword",label:"二次确认密码"},{default:l(()=>[o(r(i),{value:a.value.validateNewPassword,"onUpdate:value":e[2]||(e[2]=s=>a.value.validateNewPassword=s),placeholder:"输入二次确认密码",type:"password","show-password-on":"click"},null,8,["value"])]),_:1}),m("div",j,[o(r(U),{type:"primary",loading:r(k)||r(_),onClick:e[3]||(e[3]=s=>R())},{default:l(()=>[O(" 确定 ")]),_:1},8,["loading"])])]),_:1},8,["model"])]),_:1},8,["show"])],64))}});export{Y as _};
